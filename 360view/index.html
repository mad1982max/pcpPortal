<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
	<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
    <title>Potree Viewer</title>

	<link rel="stylesheet" type="text/css" href="./build/potree/potree.css">
	<link rel="stylesheet" type="text/css" href="./libs/jquery-ui/jquery-ui.min.css">
	<link rel="stylesheet" type="text/css" href="./libs/perfect-scrollbar/css/perfect-scrollbar.css">
	<link rel="stylesheet" href="./libs/openlayers3/ol.css" type="text/css">
	<link rel="stylesheet" href="./libs/spectrum/spectrum.css" type="text/css">
	<link rel="stylesheet" href="../vendors/css/reset.min.css">
	<link rel="stylesheet" href="../vendors/css/all.min.css">
	<link rel="stylesheet" href="./css/styles.css">
  </head>

  <body>
	<script src="./libs/jquery/jquery-3.1.1.js"></script>
	<script src="./libs/spectrum/spectrum.js"></script>
	
	<script src="./libs/perfect-scrollbar/js/perfect-scrollbar.jquery.js"></script>
	<script src="./libs/jquery-ui/jquery-ui.min.js"></script>
	<script src="./libs/three.js/build/three.js"></script>
	<script src="./libs/other/stats.min.js"></script>
	<script src="./libs/other/BinaryHeap.js"></script>
	<script src="./libs/tween/tween.min.js"></script>
	<script src="./libs/d3/d3.js"></script>
	<script src="./libs/proj4/proj4.js"></script>
	<script src="./libs/openlayers3/ol.js"></script>
    <script src="./libs/i18next/i18next.js"></script>

	<script src="js/DepthCubemapTools.js"></script>
	<script>
		var depthCubemap = new DepthCubemap();
	</script>
	<script src="./build/potree/potree.js"></script>
	<!--<script src="../src/viewer/sidebar.js"></script>-->
	
	<!-- INCLUDE ADDITIONAL DEPENDENCIES HERE -->
	<!-- INCLUDE SETTINGS HERE -->
	
	<script src="./libs/plasio/js/laslaz.js"></script>
	<script src="./libs/plasio/vendor/bluebird.js"></script>

	<script src="./js/SphereControl.js"></script>
	<script src="./js/TypeCheck.js"></script>
	<script src="./js/PointConfig.js"></script>
	<script src="./js/UISetup.js"></script>
	<script src="../shares/js/eventModule.js"></script>

	<header class="prime" style="height: 3rem;">
		<div onclick=returnFn() class="button-like">
			<img src="/assets/img/icons/back_arrow.svg" style="height: 100%; width: 2.5rem;">
		</div>

		<div class="arrows">
			<a class="left-arrow button-like" id="prev"><i class="fas fa-chevron-left"></i></a>
			<div class="point-name-display">test text</div>
			<a class="right-arrow button-like" id="next"><i class="fas fa-chevron-right"></i></a>
		</div>
		<div id="right-placeholder">
			<aside class="prime">
				<a id="map-toggle" class="button-like enabled">
					<i class="fas fa-map-marker-alt"></i>
					<div id="map-wrapper" style="z-index: -1;">
						<div class="mapBtnGroup" style="">
							<button draggable="true" class="resizeMapBtn" id="resizeMapBtn">
								<img src="../assets/img/icons/resize-ico.svg" alt="">
							</button>
							<button class="centerizeMapBtn mapBtn" id="centerizeMapBtn">
								<img src="../assets/img/icons/centerize.svg" alt="">
							</button>
							<button class="stairsUpBtn mapBtn" id="stairsUpBtn">
								<img src="../assets/img/icons/stairs_up.svg" alt="">
							</button>
							<button class="stairsDownBtn mapBtn" id="stairsDownBtn">
								<img src="../assets/img/icons/stairs_down.svg" alt="">
							</button>
						</div>
						<div id="wrapper"></div>
					</div>
				</a>
				<div class="vertical-placeholder"></div>
				<div id="measurements">
					<div class="button-like" data-action-name="angle" title="angle"><img src="/assets/img/icons/angle.svg"></div>
					<div class="button-like" data-action-name="point" title="point"><img src="/assets/img/icons/point.svg"></div>
					<div class="button-like" data-action-name="distance" title="distance"><img src="/assets/img/icons/distance.svg"></div>
					<div class="button-like" data-action-name="height" title="height"><img src="/assets/img/icons/height.svg"></div>
					<div class="button-like" data-action-name="area" title="area"><img src="/assets/img/icons/area.svg"></div>
					<div class="button-like" data-action-name="reset_tools" title="reset_tools"><img src="/assets/img/icons/reset_tools.svg"></div>
				</div>
				<div class="vertical-placeholder"></div>
				<div id="sphereVisibilityControlEye" class="button-like checkbox-like">
					<img src="/assets/img/icons/invis.svg">
					<img class="checkbox-reverse" src="/assets/img/icons/vis.svg">
				</div>
				<div id="range-control-slide-trigger" class="button-like checkbox-like">
					<img src="/assets/img/icons/invis.svg">
					<img class="checkbox-reverse" src="/assets/img/icons/vis.svg">
					<div class="slider-container">
						<input type="range" min="0" max="150" value="150" class="slider" id="range-control-slider">
						<output id="range-control-output-bubble" class="bubble"></output>
					</div>
				</div>
			</aside>
		</div>
	</header>
	<div class="potree_container" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0; ">

		<div id="potree_render_area"> </div>
		<div>
			<div id="menu">
				<div id="pointBudgetControl">
					<div id="pointBudgetTitle">
						<span></span>
						<span></span>
					</div>
					<div id="pointBudgetSlider"></div>
				</div>
				<div id="pointCloudVisibilityControl">
					<label class="container">PointCloud visible
						<input type="checkbox">
						<span class="checkmark"></span>
					</label>
					<div></div>
				</div>
				<div id="potreeUIVisibilityControl">
					<label class="container">default UI visible
						<input type="checkbox">
						<span class="checkmark"></span>
					</label>
					<div></div>
				</div>
				<div id="otherPointsRangeControl">
					<p>
						<span>Other points visible in range</span>
						<span></span>
					</p>
					<div id="sphereRangeSlider"></div>
				</div>
				<div id="otherPointsBudgetControl">
					<p>
						<span>Count of viewed other points</span>
						<span></span>
					</p>
					<div id="otherPointsBudgetSlider"></div>
				</div>
				<div id="tools"></div>
				<div id="showHideButton"></div>
			</div>
		</div>
		<div id="potree_sidebar_container"> </div>
    </div>

	<script>
		let profiles = [];
		const cubeSides = ['r','l','u','d','f','b'].map(function (side) { return side + '.jpg'; });
		const depthMapSides = ['0','1','2','3','4','5'].map(function (side) { return side + '.png'; });
		let config = new GeneralPointConfig('./pointclouds', profiles, 'pointcloud/cloud.js', cubeSides, '360', depthMapSides, 'depth-map-cube');
		profiles.push(new PointProfile(config, '1', new THREE.Vector3(-44.1870, 57.0310, 27.2240), new THREE.Euler(0,0,-54)));
		profiles.push(new PointProfile(config, '2', new THREE.Vector3(-45.1440, 57.0160, 27.2290), new THREE.Euler(0,0,38)));
		profiles.push(new PointProfile(config, '155', new THREE.Vector3(158.97, 233.67, 29.34), new THREE.Euler(2.55,-0.35,-15.55)));
		profiles.push(new PointProfile(config, '156', new THREE.Vector3(161.09, 230.81, 29.35), new THREE.Euler(1.1,3,61.4)));
		profiles.push(new PointProfile(config, '189', new THREE.Vector3(160.23, 227, 29.35), new THREE.Euler(-0.4,-1.7,-121.1)));

		let sceneControl = new SceneControl(config);
		window.viewer = sceneControl.viewer; // potree can't work without it
	</script>
  </body>
  <script src="../vendors/js/d3.js"></script>
  <script src="../vendors/js/d3-zoom.js"></script>
  <script src="../vendors/js/d3-transform.min.js"></script>
  <script src="../shares/js/points.js"></script>
  <script src="../shares/js/sublevels.js"></script>
  <script src="../shares/js/clusterization.js"></script>
  <script src="../shares/js/tail_data.js"></script>
  <script src="./js/minimap.js"></script>
  <script>
	  const pinButton = document.getElementById('map-toggle');
	  pinButton.children[1].addEventListener('click', function (e){e.stopPropagation();});
	  pinButton.addEventListener('click', function (){
		  pinButton.classList.toggle('enabled');
	  });
  </script>
  <script>
	  const pointNameDisplay = document.getElementsByClassName('point-name-display')[0];
	  switchPhoto360Observable.subscribe(function (pointCloudName){
		  const profile = sceneControl.getProfileByName(pointCloudName);
		  if (!profile) {
			  switchPhoto360Observable.notify(Potree.utils.getParameterByName('name'));
			  return;
		  }
		  sceneControl.setProfile(profile);
		  depthCubemap.setupCube(profile.fullPathToDepthCubeImages(), profile.name);
		  pointNameDisplay.textContent = pointCloudName;
		  Potree.utils.setParameter('name', profile.name);
		  const layerInfo = profile.getLayerInfo();
		  Potree.utils.setParameter('level', layerInfo.layer);
		  Potree.utils.setParameter('sub', layerInfo.sub);
	  });
	  sceneControl.addEventListener('cameraRotationChange', function (data) {
		  return viewChangeObservable.notify({ yaw: data.angle });
	  });
	  viewer.scene.camera.addEventListener('fov-changed', function (){
		  viewChangeObservable.notify({ fov: viewer.fov / 180 * Math.PI });
	  });

	  let profile = sceneControl.getProfileByQuery();
	  switchPhoto360Observable.notify(profile ? profile.name : profiles[2].name);
	  let uiControl = new UIControl(sceneControl);
  </script>
</html>
